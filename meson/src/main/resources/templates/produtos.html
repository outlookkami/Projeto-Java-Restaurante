<!DOCTYPE html>
<html lang="pt-BR" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{fragments/head :: head('CRUD Produtos')}"></th:block>
    <link rel="stylesheet" th:href="@{/css/modeloTelas.css}">
    <link rel="stylesheet" th:href="@{/css/menu-lateral.css}">
    <link rel="stylesheet" th:href="@{/css/modalIncluir.css}">
    <script th:src="@{/js/modalIncluir.js}"></script>
</head>
<body>

<div class="layout">
    <aside th:replace="~{fragments/menu-lateral :: menu-lateral}"></aside>

    <main class="content">
        <header class="header">
            <h1>Produtos</h1>
            <button type="button" class="btn-primary" onclick="modalAdd()">+ Novo Produto</button>
        </header>

        <table>
            <thead>
                <tr>
                    <th>Imagem</th>
                    <th>Nome</th>
                    <th>Preço</th>
                    <th>Categoria</th>
                    <th>Descrição</th>
                    <th>Ativo</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
            <tr th:each="produto, row : ${produtos}">
                <td></td>
                <td th:text="${produto.nome}"></td>
                <td th:text="${produto.preco}"></td>
                <td th:text="${produto.categoria}"></td>
                <td th:text="${produto.descricao}"></td>
                <td th:text="${produto.ativo == true} ? 'Sim' : 'Não'"></td>
                <td>
                    <button class="btn-edit">Editar</button>
                    <button class="btn-delete">Excluir</button>
                </td>
            </tr>
            </tbody>
        </table>

    </main>
</div>

<div id="modal" class="modal">
    <div class="modal-conteudo modal-produto">
        <span class="fechar" onclick="fecharModal()">&times;</span>
        <h3>Novo Produto</h3>

        <form th:action="@{/produtos/salvar}" method="post" enctype="multipart/form-data">
            <div class="form-div">
                <div>
                    <label>Nome do produto:</label>
                    <input type="text" name="nome" required>
                </div>

                <div>
                    <label>Preço:</label>
                    <input type="number" step="0.01" name="preco" required>
                </div>

                <div>
                    <label>Categoria:</label>
                    <select name="categoria.id" required>
                        <option value="">Selecione</option>
                        <option th:each="categoria : ${categorias}" th:text="${categoria.nome}" th:value="${categoria.id}"></option>
                    </select>
                </div>

                <div>
                    <label>Status</label>
                    <select name="ativo">
                        <option value="true">Ativo</option>
                        <option value="false">Inativo</option>
                    </select>
                </div>

                <div>
                    <label>Descrição:</label>
                    <input type="text" name="descricao">
                </div>

                <div>
                    <label>Imagem</label>
                    <input type="file" name="imagemUrl" accept="image/*" onchange="previewImagem(event)">
                </div>

                <img id="preview" class="preview-img" style="display:none">

            </div>

            <div class="modal-acoes">
                <button type="submit" class="btn btn-salvar">Salvar</button>
                <button type="button" class="btn btn-cancelar" onclick="fecharModalCategoria()">Cancelar</button>
            </div>
        </form>
    </div>
</div>

<style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Dm Sans', 'Inter', Arial, sans-serif;
  }
  .form-div{
      display: flex;
      flex-direction: column;
      gap: 10px;
  }

  select {
      width: 180px;
      height: 32px;
      font-size: 14px;
      padding: 4px;
      margin-bottom: 10px;
  }

  .modal-produto {
      width: 480px;
      max-width: 95%;
  }

  .modal-produto .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
  }

  .modal-produto textarea {
      grid-column: 1 / -1;
      min-height: 90px;
      resize: vertical;
  }

  .modal-produto input[type="file"] {
      grid-column: 1 / -1;
  }

  .preview-img {
      grid-column: 1 / -1;
      max-height: 180px;
      object-fit: contain;
      border: 1px dashed #ccc;
      border-radius: 6px;
      padding: 8px;
  }

</style>
</body>
</html>
